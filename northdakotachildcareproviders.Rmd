---
title: "Child Care Providers by Type"
author: "Xanna Burg"
output: html_document
---

## Indicator 1: Child Care Providers by Type
## Indicator 2: Child Care Capacity by Type
## Indicator 3: Child Care Providers by QRIS
**Created by:** Xanna Burg
**Date:** February, 2020
**Updated by:**

**Data Source:** North Dakota Department of Human Services 
**Purpose:** Clean the child care data provided by the Department of Human Services and update KIDS COUNT data for North Dakota.

**Data format:** final output csv to upload is in long format with the following variables: Location (character: name of location), Category (character), TimeFrame (numeric: year), Data (numeric: number or percentage), DataFormat (character: "number" or "percent"), LocationId (numeric: assigned for KIDS COUNT system)


```{r,message=FALSE}
#load required packages
library(tidyverse)
library(RPostgreSQL)
library(readxl)
library(naniar)
library(stringr)
```

```{r}
#UPDATE to reflect the current year data working with
year <- '2022'
state <- 'northdakota'

year_shortened <- substr(year,3,4)

#only need to change if using a different month than February
month <- '2'
```

```{r}
#read in the child care data
child_data <- read_excel(path=paste0("./Input/education/northdakota_",year,"_childcaredata.xlsx"),sheet=paste0(month,"-1-",year_shortened," Providers"))

#read in the quality data
quality_data <- read_excel(path=paste0("./Input/education/northdakota_",year,"_childcarequality.xlsx"))

#read in the codes for county name
countymatch <- read.csv("./Documentation/Indicator Documentation/North Dakota Data Requests/ND County Codes_for childcare.csv")


#create a dataset that has all combinations of county and category for final provider type categories
#this is to account for the fact that some combinations will be 0
providertype_kc_category <- c('Licensed','Licensed School Age','Self-declaration Providers','Registered Tribal','Approved Relative')
providertype_kc_categorylist <- as.data.frame(providertype_kc_category)
county_provider_categorylist <- crossing(countymatch,providertype_kc_categorylist) %>%
  select(-c(ndcounty_number))




#create all possible combos of quality categories and counties
quality <- c('Step 1','Step 2','Step 3','Step 4')
qualitylist <- as.data.frame(quality)
county_quality_categorylist <-crossing(countymatch,qualitylist) %>%
  select(-c(ndcounty_number))

#input location ID file for ND
locationids <- read.csv("./Input/ND KC Location IDs.csv")

#input region ID file for ND
regionids <- read.csv("./Input/ND KC Region List.csv")
```

```{r}
child_data_2 <- child_data %>%
  
  #clean up the data
  #remove cases where License Type is 'School Age Child Care' and `Max Number of Children` is 'Not Listed'
  subset(`License Type`!='School Age Child Care' | `Max Number of Children`!='Not Listed') %>%
  
  #update incorrect label 'Group in a Home' to 'Group Child Care Home'
  mutate(`License Type`=replace(`License Type`,`License Type`=='Group in a Home','Group Child Care Home')) %>%
  
  #remove any military base programs, these are not licensed
  subset(`Max Number of Children` != 'Military Base - not listed') %>%
  
  #re-assign tribal programs to tribal registration
  mutate(`License Type`=replace(`License Type`,`Max Number of Children`=='Tribal - not listed','Tribal Registration')) %>%
  
  #create new variable matching to KC categories
  mutate(category=case_when(
    `License Type`=='Child Care Center' | `License Type`=='Family Child Care' | 
      `License Type`=='Group Child Care Facility' | `License Type`=='Group Child Care Home' | 
      `License Type`=='Multiple Licensed Facility' | 
      `License Type`=='Preschool Education Facility' ~ 'Licensed',
    `License Type`=='School Age Child Care' ~ 'Licensed School Age',
    `License Type`=='Self-declaration' ~ 'Self-declaration Providers',
    `License Type`=='Tribal Registration' ~ 'Registered Tribal',
    `License Type`=='Approved Relative' ~ 'Approved Relative')) %>%
  
  #remove self-declaration capacity - we do not report unlicensed capacity
  mutate(`Max Number of Children`=replace(`Max Number of Children`,category=='Self-declaration Providers','Unlicensed')) %>%
  
  #create new capacity variable that drops unknowns, changes to numeric
  mutate(capacity=as.numeric(paste(`Max Number of Children`)))
```



## -- PROVIDERS AND CAPACITY BY TYPE --##
NOTE: SCHOOL AGE INCLUDED
```{r}
#COUNTY DATA
countysums_providerscapacity <- child_data_2 %>%

  group_by(County,category) %>%
  summarise(providers = n(),
            capacity=sum(capacity),.groups='keep') %>%
  
  #fill in missing county/group combinations
  right_join(county_provider_categorylist,by=c('County'='county','category'='providertype_kc_category')) %>%
  
  #for the missing combinations that are NA, make them zero
  mutate(providers = replace_na(providers, 0),
         capacity= replace_na(capacity,0)) %>%
  
  #fix kc naming
  rename(location=County) %>%
  mutate(locationtype='County') 


##STATE DATA
#start with county data
statesums_providerscapacity <- countysums_providerscapacity %>%
  group_by(category) %>%
  summarise(providers = sum(providers),
            capacity=sum(capacity),.groups='keep') %>%
  
  mutate(location='North Dakota') %>%
  mutate(locationtype='State') 


##STATE PLANNING REGIONS 
#start with county data
regionsums_providerscapacity <- countysums_providerscapacity %>%
  left_join(regionids,by=c('location'='county')) %>%
  group_by(region,category) %>%
  summarise(providers = sum(providers),
            capacity=sum(capacity),.groups='keep') %>%
  
  rename(location=region) %>%
  mutate(locationtype='Planning Region') 



#format to database count child care
childcareprovidersbytype <- countysums_providerscapacity %>%
  bind_rows(statesums_providerscapacity) %>%
  bind_rows(regionsums_providerscapacity) %>%
  select(-c(capacity)) %>%
  rename(data=providers) %>%
  mutate(state='North Dakota') %>%
  left_join(locationids,by=c('location'='Location')) %>%
  rename(locationid=LocationId) %>%
  mutate(timeframe=paste0(year)) %>%
  mutate(dataformat='Number') %>%
  mutate(varname='childcareprovidersbytype') 


childcarecapacitybytype <- countysums_providerscapacity %>%
  bind_rows(statesums_providerscapacity) %>%
  bind_rows(regionsums_providerscapacity) %>%
  select(-c(providers)) %>%
  
  #remove unlicensed facilities, we can no longer report
  subset(category=='Licensed' | category=='Licensed School Age') %>%
  
  rename(data=capacity) %>%
  mutate(state='North Dakota') %>%
  left_join(locationids,by=c('location'='Location')) %>%
  rename(locationid=LocationId) %>%
  mutate(timeframe=paste0(year)) %>%
  mutate(dataformat='Number') %>%
  mutate(varname='childcarecapacitybytype')


####################
####################
#DATA QUALITY CHECKS
### Before moving forward, check the output log for errors in addition to checking specifically for these quality checks

# 1. Print name of location that has a mismatched location ID
if (sum(is.na(childcareprovidersbytype$locationid))>=1) {
  print(childcareprovidersbytype$location[is.na(childcareprovidersbytype$locationid)])
} else if (sum(is.na(childcareprovidersbytype$locationid))==0) {
  'all locations match'
}


if (sum(is.na(childcarecapacitybytype$locationid))>=1) {
  print(childcarecapacitybytype$location[is.na(childcarecapacitybytype$locationid)])
} else if (sum(is.na(childcarecapacitybytype$locationid))==0) {
  'all locations match'
}

#2. Visually inspect data
View(childcareprovidersbytype)
View(childcarecapacitybytype)
```


```{r}
#add to database providers and capacity of child care
dbWriteTable(con,'northdakota',childcareprovidersbytype,append=TRUE,row.names=FALSE)
dbWriteTable(con,'northdakota',childcarecapacitybytype,append=TRUE,row.names=FALSE)
```

```{r}
#write query from database to get needed format for KC data center
#PROVIDERS OF CHILD CARE

upload_sql <- paste0("SELECT locationid,location,category,timeframe,dataformat,data
                     FROM northdakota
                     WHERE timeframe = '",year,"' AND varname='childcareprovidersbytype';")
upload_data <- dbGetQuery(con,upload_sql) %>%
  rename(LocationId=locationid,
         Location=location,
         Category=category,
         TimeFrame=timeframe,
         DataFormat=dataformat,
         Data=data)


#SAVE OUTPUT DATASET TO UPLOAD TO DATA CENTER
write.csv(upload_data,file=paste0("./Output/education/",state,"_",year,"_childcareprovidersbytype.csv"),row.names=FALSE)

#CAPACITY OF CHILD CARE

upload_sql2 <- paste0("SELECT locationid,location,category,timeframe,dataformat,data
                     FROM northdakota
                     WHERE timeframe = '",year,"' AND varname='childcarecapacitybytype' AND dataformat='Number';")
upload_data2 <- dbGetQuery(con,upload_sql2) %>%
  rename(LocationId=locationid,
         Location=location,
         Category=category,
         TimeFrame=timeframe,
         DataFormat=dataformat,
         Data=data)


#SAVE OUTPUT DATASET TO UPLOAD TO DATA CENTER
write.csv(upload_data2,file=paste0("./Output/education/",state,"_",year,"_childcarecapacitybytype.csv"),row.names=FALSE)
```






## -- Child Care Providers and Capacity by QRIS -- ##
NOTE: SCHOOL AGE NOT INCLUDED
```{r}
####CREATE COUNTY SUMMARY COUNT OF CHILD CARE
countysums_quality <- quality_data %>%

  rename(category=`Quality Rating`,
         location=County,
         capacity=`Licensed Capacity`) %>%
  mutate(capacity=as.numeric(paste(capacity))) %>%
  group_by(location,category) %>%
  summarise(providers = n(),
            capacity=sum(capacity),.groups='keep') %>%
  ungroup() %>%
  
  #join with shell to make sure all county/quality categories are represented
  right_join(county_quality_categorylist,by=c('location'='county','category'='quality')) %>%

  mutate(providers = replace_na(providers, 0),
         capacity= replace_na(capacity,0)) %>%
  mutate(locationtype='County') 

#create an overall category that shows total participating in QRIS, so we can compute the opposite later
countysums_quality2 <- countysums_quality %>%
  group_by(location,locationtype) %>%
  summarise(providers=sum(providers),
            capacity=sum(capacity),.groups='keep') %>%
  mutate(category='Total participating in QRIS')

#combine all groups
countysums_quality_combined <- countysums_quality %>%
  bind_rows(countysums_quality2) %>%
  arrange(location,category)




####CREATE STATEWIDE SUMMARY COUNT OF CHILD CARE
statesums_quality <- countysums_quality_combined %>%
  group_by(category) %>%
  summarise(providers=sum(providers),
            capacity=sum(capacity),.groups='keep') %>%
  ungroup() %>%
  mutate(location='North Dakota',
         locationtype='State')



####CREATE STATE PLANNING REGIONS SUMMARY COUNT OF CHILD CARE
#create blank shell in order to capture when 0 occurs
location <- c('Planning Region 1','Planning Region 1','Planning Region 1',
              'Planning Region 1','Planning Region 1',
              'Planning Region 2','Planning Region 2','Planning Region 2',
              'Planning Region 2','Planning Region 2',
              'Planning Region 3','Planning Region 3','Planning Region 3',
              'Planning Region 3','Planning Region 3',
              'Planning Region 4','Planning Region 4','Planning Region 4',
              'Planning Region 4','Planning Region 4',
              'Planning Region 5','Planning Region 5','Planning Region 5',
              'Planning Region 5','Planning Region 5',
              'Planning Region 6','Planning Region 6','Planning Region 6',
              'Planning Region 6','Planning Region 6',
              'Planning Region 7','Planning Region 7','Planning Region 7',
              'Planning Region 7','Planning Region 7',
              'Planning Region 8','Planning Region 8','Planning Region 8',
              'Planning Region 8','Planning Region 8')
category <- c('Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS',
              'Step 1','Step 2','Step 3','Step 4','Total participating in QRIS')
regionshell <- data.frame(location,category)

regionsums_quality <- countysums_quality_combined %>%
  left_join(regionids,by=c('location'='county')) %>%
  group_by(region,category) %>%
  summarise(providers = sum(providers),
            capacity=sum(capacity),.groups='keep') %>%
  ungroup() %>%
  
  right_join(regionshell,by=c('region'='location','category'='category')) %>%
  mutate(providers = replace_na(providers, 0),
         capacity = replace_na(capacity,0)) %>%
  mutate(locationtype='Planning Region') %>%
  rename(location=region)
```

Combine with licensed data from Kids Count database to calculate those not participating
```{r}
licensedproviders_sql <- paste0("SELECT location,data FROM northdakota WHERE timeframe = '",year,"' AND varname='childcareprovidersbytype' AND category='Licensed' AND dataformat='Number';")
licensedproviders <- dbGetQuery(con,licensedproviders_sql) %>%
  rename(totallicensedproviders=data) %>%
  mutate(totallicensedproviders=as.numeric(paste(totallicensedproviders)))

licensedcapacity_sql <- paste0("SELECT location,data FROM northdakota WHERE timeframe = '",year,"' AND varname='childcarecapacitybytype' AND category='Licensed' AND dataformat='Number';")
licensedcapacity <- dbGetQuery(con,licensedcapacity_sql) %>%
  rename(totallicensedcapacity=data) %>%
  mutate(totallicensedcapacity=as.numeric(paste(totallicensedcapacity)))

#join with full quality data
notparticipatinginquality <- countysums_quality_combined %>%
  bind_rows(statesums_quality) %>%
  bind_rows(regionsums_quality) %>%
  
  #only look at total
  subset(category=='Total participating in QRIS') %>%
  
  left_join(licensedproviders,by=c('location'='location')) %>%
  left_join(licensedcapacity,by=c('location'='location')) %>%
  
  #create column that is those not participating
  mutate(providers_notparticipating=totallicensedproviders-providers,
         capacity_notparticipating=totallicensedcapacity-capacity) %>%
  select(c(location,locationtype,providers_notparticipating,capacity_notparticipating)) %>%
  rename(providers=providers_notparticipating,
         capacity=capacity_notparticipating) %>%
  mutate(category='Not participating in QRIS')
  
  


#COMBINE ALL DATA
quality_data_combined <- countysums_quality_combined %>%
  bind_rows(statesums_quality) %>%
  bind_rows(regionsums_quality) %>%
  bind_rows(notparticipatinginquality) %>%
  subset(category != 'Total participating in QRIS') %>%
  arrange(location,category)


#format to database count child care
childcareprovidersbyquality <- quality_data_combined %>%
  select(-c(capacity)) %>%
  rename(data=providers) %>%
  mutate(state='North Dakota') %>%
  left_join(locationids,by=c('location'='Location')) %>%
  rename(locationid=LocationId) %>%
  mutate(timeframe=paste0(year)) %>%
  mutate(dataformat='Number') %>%
  mutate(varname='childcareprovidersbyquality')


childcarecapacitybyquality <- quality_data_combined %>%
  select(-c(providers)) %>%
  rename(data=capacity) %>%
  mutate(state='North Dakota') %>%
  left_join(locationids,by=c('location'='Location')) %>%
  rename(locationid=LocationId) %>%
  mutate(timeframe=paste0(year)) %>%
  mutate(dataformat='Number') %>%
  mutate(varname='childcarecapacitybyquality')


####################
####################
#DATA QUALITY CHECKS
### Before moving forward, check the output log for errors in addition to checking specifically for these quality checks

# 1. Print name of location that has a mismatched location ID
if (sum(is.na(childcareprovidersbyquality$locationid))>=1) {
  print(childcareprovidersbyquality$location[is.na(childcareprovidersbyquality$locationid)])
} else if (sum(is.na(childcareprovidersbyquality$locationid))==0) {
  'all locations match'
}


if (sum(is.na(childcarecapacitybyquality$locationid))>=1) {
  print(childcarecapacitybyquality$location[is.na(childcarecapacitybyquality$locationid)])
} else if (sum(is.na(childcarecapacitybyquality$locationid))==0) {
  'all locations match'
}

#2. Visually inspect data
View(childcareprovidersbyquality)
View(childcarecapacitybyquality)
```

```{r}
#add to database count of child care
dbWriteTable(con,'northdakota',childcareprovidersbyquality,append=TRUE,row.names=FALSE)
dbWriteTable(con,'northdakota',childcarecapacitybyquality,append=TRUE,row.names=FALSE)
```


```{r}
#calculate percentages out of all licensed facilities
qualityproviders_sql <- paste0("SELECT locationid,locationtype,location,category,timeframe,dataformat,data FROM northdakota WHERE timeframe = '",year,"' AND varname='childcareprovidersbyquality' AND dataformat='Number';")
quality_providers <- dbGetQuery(con,qualityproviders_sql) %>%
  rename(quality_providers=data)
  

licensedproviders_sql <- paste0("SELECT locationid,locationtype,location,timeframe,dataformat,data FROM northdakota WHERE timeframe = '",year,"' AND varname='childcareprovidersbytype' AND category='Licensed';")
licensed_providers <- dbGetQuery(con,licensedproviders_sql) %>%
  rename(licensed_providers=data)


quality_percents <- quality_providers %>%
  left_join(licensed_providers) %>%
  arrange(location,category) %>%
  mutate(quality_providers=as.numeric(paste(quality_providers)),
         licensed_providers=as.numeric(paste(licensed_providers))) %>%
  #calculate percentages
  mutate(percent_providers=quality_providers/licensed_providers) %>%
  
  #add in KC variables
  mutate(dataformat='Percent')


quality_percent_providers <- quality_percents %>%
  rename(data=percent_providers) %>%
  select(c(locationid,locationtype,location,category,timeframe,dataformat,data)) %>%
  mutate(varname='childcareprovidersbyquality')




#calculate percentages out of all licensed facilities
qualitycapacity_sql <- paste0("SELECT locationid,locationtype,location,category,timeframe,dataformat,data FROM northdakota WHERE timeframe = '",year,"' AND varname='childcarecapacitybyquality' AND dataformat='Number';")
quality_capacity <- dbGetQuery(con,qualitycapacity_sql) %>%
  rename(quality_capacity=data)
  

licensedcapacity_sql <- paste0("SELECT locationid,locationtype,location,timeframe,dataformat,data FROM northdakota WHERE timeframe = '",year,"' AND varname='childcarecapacitybytype' AND category='Licensed';")
licensed_capacity <- dbGetQuery(con,licensedcapacity_sql) %>%
  rename(licensed_capacity=data)


quality_percents_capacity <- quality_capacity %>%
  left_join(licensed_capacity) %>%
  arrange(location,category) %>%
  mutate(quality_capacity=as.numeric(paste(quality_capacity)),
         licensed_capacity=as.numeric(paste(licensed_capacity))) %>%
  #calculate percentages
  mutate(percent_capacity=quality_capacity/licensed_capacity) %>%
  
  #add in KC variables
  mutate(dataformat='Percent')


quality_percent_capacity <- quality_percents_capacity %>%
  rename(data=percent_capacity) %>%
  select(c(locationid,locationtype,location,category,timeframe,dataformat,data)) %>%
  mutate(varname='childcarecapacitybyquality')







####################
####################
#DATA QUALITY CHECKS
### Before moving forward, check the output log for errors in addition to checking specifically for these quality checks

# 1. Print name of location that has a mismatched location ID
if (sum(is.na(quality_percent_providers$locationid))>=1) {
  print(quality_percent_providers$location[is.na(quality_percent_providers$locationid)])
} else if (sum(is.na(quality_percent_providers$locationid))==0) {
  'all locations match'
}

if (sum(is.na(quality_percent_capacity$locationid))>=1) {
  print(quality_percent_capacity$location[is.na(quality_percent_capacity$locationid)])
} else if (sum(is.na(quality_percent_capacity$locationid))==0) {
  'all locations match'
}



#2. Visually inspect data
View(quality_percent_providers)
View(quality_percent_capacity)

```



```{r}
#add to database count of child care
dbWriteTable(con,'northdakota',quality_percent_providers,append=TRUE,row.names=FALSE)
dbWriteTable(con,'northdakota',quality_percent_capacity,append=TRUE,row.names=FALSE)
```

```{r}
#write query from database to get needed format for KC data center
#PROVIDERS
upload_data_qualityproviders_sql <- paste0("SELECT locationid,location,category,timeframe,dataformat,data
                     FROM northdakota
                     WHERE timeframe = '",year,"' AND varname = 'childcareprovidersbyquality';")
upload_data_qualityproviders <- dbGetQuery(con,upload_data_qualityproviders_sql) %>%
  rename(LocationId=locationid,
         Location=location,
         Category=category,
         TimeFrame=timeframe,
         DataFormat=dataformat,
         Data=data) 


#SAVE OUTPUT DATASET TO UPLOAD TO DATA CENTER
write.csv(upload_data_qualityproviders,file=paste0("./Output/education/",state,"_",year,"_childcareprovidersbyquality.csv"),row.names=FALSE)

#CAPACITY
upload_data_qualitycapacity_sql <- paste0("SELECT locationid,location,category,timeframe,dataformat,data
                     FROM northdakota
                     WHERE timeframe = '",year,"' AND varname = 'childcarecapacitybyquality';")
upload_data_qualitycapacity <- dbGetQuery(con,upload_data_qualitycapacity_sql) %>%
  rename(LocationId=locationid,
         Location=location,
         Category=category,
         TimeFrame=timeframe,
         DataFormat=dataformat,
         Data=data) 


#SAVE OUTPUT DATASET TO UPLOAD TO DATA CENTER
write.csv(upload_data_qualitycapacity,file=paste0("./Output/education/",state,"_",year,"_childcarecapacitybyquality.csv"),row.names=FALSE)
```



## OLD CODE USED TO CALCULATE THE PERCENTAGES FOR 1998-2020
```{r}
#FOR  CHILD CARE CAPACITY
#create percentages using ACS data in database
#variable needed for denominator calculation is childrenages0to13parentsinlaborforce
#need denominator variable for two years prior
year_minus1 <- as.character(as.numeric(year)-1)
year_minus5 <- as.character(as.numeric(year)-5)

children_estimates_sql <- paste0("SELECT locationid,data FROM northdakota WHERE timeframe='",year_minus5,"-",year_minus1,"' AND varname='childrenages0to13parentsinlaborforce' AND dataformat='Number' AND age_group='0 to 13';")
children_estimates <- dbGetQuery(con,children_estimates_sql) %>%
  rename(children_estimate=data) %>%
  mutate(children_estimate=as.numeric(paste(children_estimate)))

childcarecapacitybytype2 <- childcarecapacitybytype %>%
  mutate(data=as.numeric(paste(data))) %>%
  group_by(location,locationtype,state,locationid,timeframe,dataformat) %>%
  summarise(childcare_estimate=sum(data)) %>%
  ungroup %>%
  mutate(dataformat='Percent') %>%
  left_join(children_estimates,by='locationid') %>%
  mutate(data=(childcare_estimate/children_estimate)) %>%
  mutate(state='North Dakota') %>%
  select(-children_estimate) %>%
  select(-childcare_estimate) %>%
  mutate(varname='percentofchildrenages0to13withparentsworkingservedbyececapacity_oldmethodology')

####################
####################
#DATA QUALITY CHECKS
### Before moving forward, check the output log for errors in addition to checking specifically for these quality checks

# 1. Print name of location that has a mismatched location ID
if (sum(is.na(childcarecapacitybytype2$locationid))>=1) {
  print(childcarecapacitybytype2$location[is.na(childcarecapacitybytype2$locationid)])
} else if (sum(is.na(childcarecapacitybytype2$locationid))==0) {
  'all locations match'
}

#2. Visually inspect data
View(childcarecapacitybytype2)

```

```{r}
#add to database
dbWriteTable(con,'northdakota',childcarecapacitybytype2,append=TRUE,row.names=FALSE)
```

```{r}
#write query from database to get needed format for KC data center

upload_data_capacity_sql <- paste0("SELECT locationid,location,timeframe,dataformat,data
                     FROM northdakota
                     WHERE timeframe = '",year,"' AND varname = 'percentofchildrenages0to13withparentsworkingservedbyececapacity_oldmethodology';")
upload_data_capacity <- dbGetQuery(con,upload_data_capacity_sql) %>%
  rename(LocationId=locationid,
         Location=location,
         TimeFrame=timeframe,
         DataFormat=dataformat,
         Data=data) %>%
  subset(Data!='NA')


#SAVE OUTPUT DATASET TO UPLOAD TO DATA CENTER
write.csv(upload_data_capacity,file=paste0("./Output/education/",state,"_",year,"_childcarecapacitybytype_percent.csv"),row.names=FALSE)
```



